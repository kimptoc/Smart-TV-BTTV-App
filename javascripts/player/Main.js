((function(){window.Main={selectedVideo:0,mode:0,mute:0,UP:0,DOWN:1,WINDOW:0,FULLSCREEN:1,NMUTE:0,YMUTE:1},Main.onLoad=function(){return Player.init()&&Audio.init()&&Display.init()&&Server.init()?(bttv.log("Main.onLoad, all init's done"),Display.setVolume(Audio.getVolume()),bttv.log("Main.onLoad, volume sorted"),Display.setTime(0),bttv.log("Main.onLoad, time sorted"),Main.selectedVideo=0,Player.stopCallback=function(){return Main.setWindowMode()},Server.dataReceivedCallback=function(){return Display.setVideoList(Data.getVideoNames()),Main.updateCurrentVideo()},bttv.log("about to call 'fetchVideoList'"),Server.fetchVideoList(),Main.enableKeys()):bttv.log("Failed to initialise")},Main.onUnload=function(){return Player.deinit()},Main.updateCurrentVideo=function(a){return Player.setVideoURL(Data.getVideoURL(Main.selectedVideo)),Display.setVideoListPosition(Main.selectedVideo,a),Display.setDescription(Data.getVideoDescription(Main.selectedVideo))},Main.enableKeys=function(){var a,b,c,d;return bttv.log("Main.enableKeys"),KeyboardJS.unbind.key("all"),b=function(){var a;return bttv.log("RETURN"),Player.stopVideo(),(a=bttv.widgetAPI)!=null&&a.sendReturnEvent(),bttv.station_controller.handleShowStations()},KeyboardJS.bind.key("return",b),KeyboardJS.bind.key("panel_return",b),KeyboardJS.bind.key("escape",b),KeyboardJS.bind.key("play",function(){return bttv.log("PLAY"),Main.handlePlayKey()}),KeyboardJS.bind.key("stop",function(){return bttv.log("STOP"),Player.stopVideo()}),KeyboardJS.bind.key("pause",function(){return bttv.log("PAUSE"),Main.handlePauseKey()}),KeyboardJS.bind.key("ff",function(){bttv.log("FF");if(Player.getState()!==Player.PAUSED)return Player.skipForwardVideo()}),KeyboardJS.bind.key("rw",function(){bttv.log("RW");if(Player.getState()!==Player.PAUSED)return Player.skipBackwardVideo()}),d=function(){bttv.log("VOL_UP");if(Main.mute===0)return Audio.setRelativeVolume(0)},KeyboardJS.bind.key("vol_up",d),KeyboardJS.bind.key("panel_vol_up",d),c=function(){bttv.log("VOL_DOWN");if(Main.mute===0)return Audio.setRelativeVolume(1)},KeyboardJS.bind.key("vol_down",c),KeyboardJS.bind.key("panel_vol_down",c),KeyboardJS.bind.key("down",function(){return bttv.log("DOWN"),Main.selectNextVideo(Main.DOWN)}),KeyboardJS.bind.key("up",function(){return bttv.log("UP"),Main.selectPreviousVideo(Main.UP)}),a=function(){return bttv.log("ENTER"),Main.toggleMode()},KeyboardJS.bind.key("enter",a),KeyboardJS.bind.key("panel_enter",a),KeyboardJS.bind.key("mute",function(){return bttv.log("MUTE"),Main.muteMode()})},Main.handlePlayKey=function(){switch(Player.getState()){case Player.STOPPED:return Player.playVideo();case Player.PAUSED:return Player.resumeVideo();default:return bttv.log("Ignoring play key, not in correct state")}},Main.handlePauseKey=function(){switch(Player.getState()){case Player.PLAYING:return Player.pauseVideo();default:return bttv.log("Ignoring pause key, not in correct state")}},Main.selectNextVideo=function(a){return Player.stopVideo(),Main.selectedVideo=(Main.selectedVideo+1)%Data.getVideoCount(),Main.updateCurrentVideo(a)},Main.selectPreviousVideo=function(a){return Player.stopVideo(),--Main.selectedVideo<0&&(Main.selectedVideo+=Data.getVideoCount()),Main.updateCurrentVideo(a)},Main.setFullScreenMode=function(){if(Main.mode!==Main.FULLSCREEN)return Display.hide(),Player.setFullscreen(),Main.mode=Main.FULLSCREEN},Main.setWindowMode=function(){if(Main.mode!==Main.WINDOW)return Display.show(),Player.setWindow(),Main.mode=Main.WINDOW},Main.toggleMode=function(){Player.getState()===Player.PAUSED&&Player.resumeVideo();switch(Main.mode){case Main.WINDOW:return Main.setFullScreenMode();case Main.FULLSCREEN:return Main.setWindowMode();default:return bttv.log("ERROR: unexpected mode in toggleMode")}},Main.setMuteMode=function(){if(Main.mute!==Main.YMUTE)return Audio.plugin.SetUserMute(!0),document.getElementById("volumeBar").style.backgroundImage="url(Images/videoBox/muteBar.png)",document.getElementById("volumeIcon").style.backgroundImage="url(Images/videoBox/mute.png)",$("volumeInfo").html("MUTE"),Main.mute=Main.YMUTE},Main.noMuteMode=function(){if(Main.mute!==Main.NMUTE)return Audio.plugin.SetUserMute(!1),document.getElementById("volumeBar").style.backgroundImage="url(Images/videoBox/volumeBar.png)",document.getElementById("volumeIcon").style.backgroundImage="url(Images/videoBox/volume.png)",Display.setVolume(Audio.getVolume()),Main.mute=Main.NMUTE},Main.muteMode=function(){switch(Main.mute){case Main.NMUTE:return Main.setMuteMode();case Main.YMUTE:return Main.noMuteMode();default:return bttv.log("ERROR: unexpected mode in muteMode")}}})).call(this)